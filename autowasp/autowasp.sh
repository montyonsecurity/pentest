#!/bin/bash

if [ "$EUID" -ne 0 ];
then
    echo -e "\e[91m[-]\e[0m Error: Permission Denied"
    echo -e "\e[93m[!]\e[0m Action: Run with sudo or as root"
    exit
fi

if [[ "$1" -eq "" ]] 2> /dev/null;
then
    echo -e "\e[92m[+]\e[0m Command examples"
    echo "FQDN - sudo autowasp.sh fqdn.domain.top_level"
    echo "Domain - sudo autowasp.sh domain.top_level"
    echo "IPv4 - sudo autowasp.sh 0.0.0.0"
    echo "IPv6 - sudo autowasp.sh ::1"
    exit
fi

protocols=(
    http
    https
)

for i in "${protocols[@]}"
do
    echo -e "\e[92m[+]\e[0m Conducting web application penetration testing on $i://$1 at $(date): zap-cli -v --zap-path /usr/share/zaproxy/zap.sh start -o '-config api.key=12345' 2> /dev/null 1>&2; zap-cli -v --api-key 12345 quick-scan --spider --ajax-spider --recursive --alert-level Low $i://$1/ 2> /dev/null 1>&2; zap-cli --api-key 12345 report --output owasp_zap_$i_$(echo $1 | tr ':' '_').html --output-format html 2> /dev/null 1>&2; zap-cli -v --api-key 12345 shutdown 2> /dev/null 1>&2; zap-cli --api-key 12345 shutdown 2> /dev/null 1>&2" | tee -a documentation_$(echo $1 | tr '.' '_').txt
    zap-cli -v --zap-path /usr/share/zaproxy/zap.sh start -o '-config api.key=12345' 2> /dev/null 1>&2
    zap-cli -v --api-key 12345 quick-scan --spider --ajax-spider --recursive --alert-level Low $i://$1/ 2> /dev/null 1>&2
    zap-cli -v --api-key 12345 report --output owasp_zap_"$i"_$(echo $1 | tr ':' '_').html --output-format html 2> /dev/null 1>&2
    zap-cli -v --api-key 12345 shutdown 2> /dev/null 1>&2
    IFS=$'\n'
    for j in $(egrep -i "high|medium|low|informational" owasp_zap_$i_$(echo $1 | tr '.:' '__').html 2> /dev/null | grep "a name" | sed 's/.*width.*\%\">//1' | sed 's/.....$//g')
    do
	echo -e "\e[92m[+]\e[0m Vulnerability Found on $i://$1: $j" | tee -a documentation_$(echo $1 | tr '.:' '__').txt
    done
    unset IFS
done
