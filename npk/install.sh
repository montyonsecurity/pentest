#!/bin/bash

if [ "$EUID" -ne 0 ];
then
	echo -e "\e[91m[-]\e[0m Error: Permission Denied"
	echo -e "\e[93m[!]\e[0m Action: Run with sudo or as root"
	exit
fi

read -p "AWS Username: " AWS_NAME
read -p "Phone Number (e.g. 1555555555): " SMS
read -p "Email: " ADMIN_EMAIL

apt update
apt install awscli git jq jsonnet npm unzip wget -y
mkdir /opt/terraform
cd /opt/terraform
wget "https://releases.hashicorp.com/terraform/0.11.14/terraform_0.11.14_linux_amd64.zip"
unzip "terraform_0.11.14_linux_amd64.zip"
cp terraform /usr/bin/terraform
aws configure
sed -i "s/default/$AWS_NAME/g" /root/.aws/credentials
cd /opt/
git clone "https://github.com/Coalfire-Research/npk.git"
cd /opt/npk/terraform/
grep -v dev npk-settings.json.sample | sed "s/demo@npkproject.io/$ADMIN_EMAIL/g" | sed "s/13035551234/$SMS/g" | sed "s/npk/$AWS_NAME/g" > npk-settings.json
bash deploy.sh
